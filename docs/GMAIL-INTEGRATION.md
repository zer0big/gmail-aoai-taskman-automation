# Gmail ì—°ë™ ê°€ì´ë“œ

> **ìƒíƒœ**: âœ… **ìš´ì˜ ì¤‘** (2026-01-31) | E2E í…ŒìŠ¤íŠ¸ ì„±ê³µ

---

## ğŸ“Š í˜„ì¬ ìš´ì˜ êµ¬ì„±

| í•­ëª© | ê°’ |
|------|-----|
| **ì—°ë™ ë°©ì‹** | Google Apps Script (5ë¶„ í´ë§) |
| **Apps Script í”„ë¡œì íŠ¸** | Email2ADO-Trigger |
| **Gmail í•„í„°** | `Microsoft OR MVP` í‚¤ì›Œë“œ |
| **Gmail ë ˆì´ë¸”** | Email2ADO â†’ Email2ADO/Processed |
| **HTTP Trigger** | HTTP_Trigger |
| **Logic App** | email2ado-logic-prod |
| **ì›Œí¬í”Œë¡œìš°** | Email2ADO-HTTP |

---

## ğŸ“‹ ëª©ì°¨

1. [ì•„í‚¤í…ì²˜](#1-ì•„í‚¤í…ì²˜)
2. [V1 ì»¤ë„¥í„° ì œí•œì‚¬í•­](#2-v1-ì»¤ë„¥í„°-ì œí•œì‚¬í•­)
3. [í˜„ì¬ í•´ê²°ì±…: Google Apps Script](#3-í˜„ì¬-í•´ê²°ì±…-google-apps-script)
4. [Gmail í•„í„° ì„¤ì •](#4-gmail-í•„í„°-ì„¤ì •)
5. [í•„ë“œ ë§¤í•‘ ì°¸ì¡°](#5-í•„ë“œ-ë§¤í•‘-ì°¸ì¡°)
6. [ëŒ€ì•ˆ ì˜µì…˜](#6-ëŒ€ì•ˆ-ì˜µì…˜)
7. [ë¬¸ì œ í•´ê²°](#7-ë¬¸ì œ-í•´ê²°)

---

## 1. ì•„í‚¤í…ì²˜

### í˜„ì¬ ìš´ì˜ ì•„í‚¤í…ì²˜ (v2.4.0)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Gmail     â”‚     â”‚  Gmail Filter        â”‚     â”‚  Google Apps       â”‚
â”‚   Inbox     â”‚â”€â”€â”€â”€â–¶â”‚  (Microsoft OR MVP)  â”‚â”€â”€â”€â”€â–¶â”‚  Script            â”‚
â”‚             â”‚     â”‚  â†’ Email2ADO ë ˆì´ë¸”   â”‚     â”‚  (5ë¶„ í´ë§)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                    HTTP POST
                                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Email2ADO-HTTP (Logic App Standard)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  HTTP_Trigger â†’ ì¤‘ë³µì²´í¬ â†’ AIë¶„ì„ â†’ Work Item ìƒì„± â†’ Teams ì•Œë¦¼    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì™œ ì´ ì•„í‚¤í…ì²˜ì¸ê°€?

| í•­ëª© | Email2ADO-Gmail (ì‚¬ìš© ë¶ˆê°€) | Email2ADO-HTTP (í˜„ì¬ ì‚¬ìš©) |
|------|---------------------------|---------------------------|
| íŠ¸ë¦¬ê±° | Gmail V1 ì»¤ë„¥í„° | HTTP Trigger + Apps Script |
| ìƒíƒœ | âŒ Unhealthy | âœ… Healthy |
| í´ë§ | V1 ì œí•œìœ¼ë¡œ ë¶ˆê°€ | Apps Script 5ë¶„ ê°„ê²© |
| ì¸ì¦ | Easy Auth í•„ìš” | SAS ì„œëª… (ìµëª… í—ˆìš©) |

---

## 2. V1 ì»¤ë„¥í„° ì œí•œì‚¬í•­

### ë¬¸ì œì 

Logic App **Standard**ì—ì„œ Gmail V1 ì»¤ë„¥í„°ëŠ” ë‹¤ìŒ ì œí•œì´ ìˆìŠµë‹ˆë‹¤:

```
âŒ connectionRuntimeUrl ë¯¸ì§€ì›
âŒ ApiConnectionNotification íŠ¸ë¦¬ê±° ë¶ˆê°€
âŒ ì‹¤ì œ í´ë§ ìˆ˜í–‰ ì•ˆ í•¨
```

### ì¦ìƒ

```powershell
# ì›Œí¬í”Œë¡œìš° ìƒíƒœ í™•ì¸ ì‹œ Unhealthy
az rest --method GET \
  --uri ".../workflows/Email2ADO-Gmail?api-version=2023-01-01" \
  | ConvertFrom-Json | Select-Object -ExpandProperty properties | Select-Object health
# ê²°ê³¼: { "state": "Unhealthy" }
```

### ê·¼ë³¸ ì›ì¸

- Logic App **Consumption**ì—ì„œëŠ” V1 Gmail ì»¤ë„¥í„° ì •ìƒ ë™ì‘
- Logic App **Standard**ì—ì„œëŠ” V2 ì»¤ë„¥í„°ë§Œ ì™„ì „ ì§€ì›
- Gmailì€ V2 ì»¤ë„¥í„° ë¯¸ì œê³µ (2026ë…„ 1ì›” ê¸°ì¤€)

---

## 3. í˜„ì¬ í•´ê²°ì±…: Google Apps Script

### 3.1 ì‚¬ì „ ìš”êµ¬ì‚¬í•­

- Google ê³„ì • (Gmail ì ‘ê·¼ ê¶Œí•œ)
- Logic App HTTP Trigger URL

### 3.2 Apps Script ì„¤ì •

1. **[script.google.com](https://script.google.com)** ì ‘ì†

2. **ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±**: `Email2ADO-Trigger`

3. **ì½”ë“œ ë¶™ì—¬ë„£ê¸°**: `scripts/gmail-trigger.gs` ì „ì²´ ë³µì‚¬

4. **ì €ì¥** (Ctrl+S)

### 3.3 íŠ¸ë¦¬ê±° ì„¤ì •

1. ì¢Œì¸¡ **â° íŠ¸ë¦¬ê±°** í´ë¦­
2. **"+ íŠ¸ë¦¬ê±° ì¶”ê°€"** í´ë¦­
3. ì„¤ì •:
   - ì‹¤í–‰í•  í•¨ìˆ˜: `processNewEmails`
   - ì´ë²¤íŠ¸ ì†ŒìŠ¤: `ì‹œê°„ ê¸°ë°˜`
   - ìœ í˜•: `ë¶„ ë‹¨ìœ„ íƒ€ì´ë¨¸`
   - ê°„ê²©: `5ë¶„ë§ˆë‹¤`
4. **ì €ì¥**

### 3.4 ê¶Œí•œ ìŠ¹ì¸

ì²« ì‹¤í–‰ ì‹œ Google ê¶Œí•œ ìš”ì²­:

1. "ê¶Œí•œ ê²€í† " í´ë¦­
2. Google ê³„ì • ì„ íƒ
3. "ê³ ê¸‰" > "Email2ADO-Trigger(ìœ¼)ë¡œ ì´ë™(ì•ˆì „í•˜ì§€ ì•ŠìŒ)" í´ë¦­
4. "í—ˆìš©" í´ë¦­

> âš ï¸ ë³¸ì¸ ê³„ì •ìœ¼ë¡œ ë§Œë“  ìŠ¤í¬ë¦½íŠ¸ì´ë¯€ë¡œ ì•ˆì „í•©ë‹ˆë‹¤.

### 3.5 HTTP Trigger URL

í˜„ì¬ ìš´ì˜ URL (gmail-trigger.gsì— ì„¤ì •ë¨):

```
https://email2ado-logic-prod.azurewebsites.net/api/Email2ADO-HTTP/triggers/HTTP_Trigger/invoke?api-version=2022-05-01&sp=%2Ftriggers%2FHTTP_Trigger%2Frun&sv=1.0&sig=<YOUR_SAS_SIGNATURE>
```

> âš ï¸ **ë³´ì•ˆ**: SAS ì„œëª…(`sig=...`)ì€ Azure Portalì—ì„œ í™•ì¸í•˜ì—¬ Apps Script Propertiesì— ì €ì¥í•˜ì„¸ìš”.

---

## 4. Gmail í•„í„° ì„¤ì •

ìë™ìœ¼ë¡œ `Email2ADO` ë ˆì´ë¸”ì„ ì ìš©í•˜ë ¤ë©´ Gmail í•„í„°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

### 4.1 í•„í„° ìƒì„±

1. **Gmail** > âš™ï¸ **ì„¤ì •** > **ëª¨ë“  ì„¤ì • ë³´ê¸°**
2. **"í•„í„° ë° ì°¨ë‹¨ëœ ì£¼ì†Œ"** íƒ­
3. **"ìƒˆ í•„í„° ë§Œë“¤ê¸°"** í´ë¦­

### 4.2 í˜„ì¬ í•„í„° ì¡°ê±´

```
í¬í•¨í•˜ëŠ” ë‹¨ì–´: Microsoft OR MVP
```

> ğŸ’¡ `OR`ëŠ” **ëŒ€ë¬¸ì**ë¡œ ì…ë ¥

### 4.3 ë™ì‘ ì„¤ì •

- âœ… **ë¼ë²¨ ì ìš©**: `Email2ADO`
- âœ… **ì¼ì¹˜í•˜ëŠ” ëŒ€í™”ì—ë„ í•„í„° ì ìš©** (ì„ íƒ)

### 4.4 ì¶”ê°€ í•„í„° ì˜ˆì‹œ

| ëª©ì  | í•„í„° ì¡°ê±´ |
|------|----------|
| íŠ¹ì • ë°œì‹ ì | `from:@microsoft.com` |
| ì œëª© í‚¤ì›Œë“œ | `subject:(Azure OR MVP)` |
| ë³µí•© ì¡°ê±´ | `from:@microsoft.com subject:MVP` |

---

## 5. í•„ë“œ ë§¤í•‘ ì°¸ì¡°

### Apps Script â†’ Logic App í˜ì´ë¡œë“œ

| í•„ë“œ | ì„¤ëª… | ì˜ˆì‹œ ê°’ |
|------|------|---------|
| `messageId` | Gmail ë©”ì‹œì§€ ID (prefix: gmail-) | `gmail-19c125c8cdaf4de9` |
| `subject` | ì´ë©”ì¼ ì œëª© | `MVP TEST` |
| `body` | ë³¸ë¬¸ (ìµœëŒ€ 5000ì) | `ì•ˆë…•í•˜ì„¸ìš”...` |
| `from` | ë°œì‹ ì ì´ë©”ì¼ | `zerobig.kim@gmail.com` |
| `receivedDateTime` | ìˆ˜ì‹  ì‹œê°„ (ISO 8601) | `2026-01-31T04:43:00Z` |
| `source` | ì†ŒìŠ¤ ì‹ë³„ì | `Gmail-AppsScript` |

### Gmail API í•„ë“œ (ì°¸ì¡°ìš©)

| ë°ì´í„° | Gmail API | Apps Script |
|--------|-----------|-------------|
| Message ID | `id` | `message.getId()` |
| ì œëª© | `payload.headers[Subject]` | `message.getSubject()` |
| ë³¸ë¬¸ | `payload.body.data` | `message.getPlainBody()` |
| ë°œì‹ ì | `payload.headers[From]` | `message.getFrom()` |
| ìˆ˜ì‹  ì‹œê°„ | `internalDate` | `message.getDate()` |

---

## 6. ëŒ€ì•ˆ ì˜µì…˜

### Option B: Power Automate

**ì¥ì **: GUI ê¸°ë°˜, Microsoft 365 í†µí•©

```
Power Automate íë¦„:
Gmail íŠ¸ë¦¬ê±° â†’ HTTP ì•¡ì…˜ (Logic App í˜¸ì¶œ)
```

**ì„¤ì • ë³µì¡ë„**: ì¤‘ê°„

### Option C: Azure Functions

**ì¥ì **: Azure ë„¤ì´í‹°ë¸Œ, í™•ì¥ì„±

**ë‹¨ì **: Gmail OAuth2 êµ¬í˜„ í•„ìš”, Refresh Token ê´€ë¦¬ ë³µì¡

**ê¶Œì¥í•˜ì§€ ì•ŠìŒ** - Apps Scriptê°€ ë” ê°„ë‹¨

---

## 7. ë¬¸ì œ í•´ê²°

### 7.1 Apps Script ê¶Œí•œ ì˜¤ë¥˜

**ì¦ìƒ**: `Exception: You do not have permission to call UrlFetchApp.fetch`

**í•´ê²°**:
1. íŠ¸ë¦¬ê±° ì‚­ì œ í›„ ì¬ìƒì„±
2. `testWebhook` í•¨ìˆ˜ ìˆ˜ë™ ì‹¤í–‰ìœ¼ë¡œ ê¶Œí•œ ì¬ìŠ¹ì¸

### 7.2 HTTP 401 Unauthorized

**ì¦ìƒ**: Logic App í˜¸ì¶œ ì‹œ 401 ì˜¤ë¥˜

**ì›ì¸**: Easy Authê°€ í™œì„±í™”ëœ ê²½ìš°

**í•´ê²°**: 
- Easy Auth ë¹„í™œì„±í™” (í˜„ì¬ ìƒíƒœ) ë˜ëŠ”
- Service Principal Bearer Token ì‚¬ìš©

```powershell
# Easy Auth ìƒíƒœ í™•ì¸
az webapp auth show --name email2ado-logic-prod --resource-group rg-zb-taskman --query enabled
# ê²°ê³¼: false (ë¹„í™œì„±í™”ë¨)
```

### 7.3 ì´ë©”ì¼ì´ ì²˜ë¦¬ë˜ì§€ ì•ŠìŒ

**í™•ì¸ ìˆœì„œ**:

1. **Gmail ë ˆì´ë¸” í™•ì¸**: ì´ë©”ì¼ì— `Email2ADO` ë ˆì´ë¸”ì´ ìˆëŠ”ì§€
2. **Apps Script ë¡œê·¸ í™•ì¸**: View > Logs
3. **Table Storage í™•ì¸**:
   ```powershell
   az storage entity query --table-name ProcessedEmails \
     --account-name stemail2adoprodxhum3jlfa \
     --query "items[-3:]" -o table
   ```

### 7.4 "ì²˜ë¦¬í•  ìƒˆ ì´ë©”ì¼ ì—†ìŒ" ë¡œê·¸

**ì›ì¸**: `Email2ADO` ë ˆì´ë¸”ì´ ìˆëŠ” ì´ë©”ì¼ì´ ì—†ìŒ

**í•´ê²°**: Gmail í•„í„° ì„¤ì • ë˜ëŠ” ìˆ˜ë™ìœ¼ë¡œ ë ˆì´ë¸” ì ìš©

---

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

| ë¬¸ì„œ | ë‚´ìš© |
|------|------|
| [ARCHITECTURE.md](ARCHITECTURE.md) | ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ |
| [TROUBLESHOOTING.md](TROUBLESHOOTING.md) | ì „ì²´ ë¬¸ì œ í•´ê²° ê°€ì´ë“œ |
| [DEPLOY.md](DEPLOY.md) | Azure ë°°í¬ ê°€ì´ë“œ |

---

## ğŸ“ ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë²„ì „ | ë³€ê²½ ë‚´ìš© |
|------|------|----------|
| 2026-01-31 | v2.4.0 | Gmail ìë™ ì—°ë™ ì™„ë£Œ, E2E í…ŒìŠ¤íŠ¸ ì„±ê³µ |
| 2026-01-31 | - | Easy Auth ë¹„í™œì„±í™”, HTTP_Trigger URL ìˆ˜ì • |
| 2026-01-31 | - | Gmail í•„í„° ì„¤ì • (Microsoft OR MVP) |
| 2026-01-31 | - | GMAIL-SETUP.md, GMAIL-FIELD-MAPPING.md í†µí•© |
